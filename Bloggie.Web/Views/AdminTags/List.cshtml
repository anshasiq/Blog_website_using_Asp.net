@model List<Bloggie.Web.Models.Domain.Tags>
@{
}
<head>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css" rel="stylesheet" />
</head>
<div class="bg-secondary bg-opacity-10 py-2">
    <div class="container">
        <h1>Add New Tag - Admin Functionality</h1>
    </div>
</div>


<div class="container py-5">
@if (TempData["SuccessMessage"] != null)
{
    if (TempData["SuccessMessage"].ToString() == "Saved successfully!")
    {
            <div class="alert alert-success alert-dismissible fade show" role="alert">
                Added Successfully!
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
    }
    else if (TempData["SuccessMessage"].ToString() == "Saved Unsuccessfully!")
    {
            <div class="alert alert-danger">
                @TempData["SuccessMessage"]
            </div>
    }
}

    <table class="table table-bordered">
        <thead>
            <tr>
                <th scope="col">Id</th>
                <th scope="col">Name</th>
                <th scope="col">Display Name</th>
                <th scope="col">Actions</th>
                <th scope="col">Created At</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var tag in Model)
            {
                <tr>
                    <td>@tag.Id</td>
                    <td>@tag.Name</td>
                    <td data-time="@tag.CreatedAt.ToString("o")"></td>
                    @* <td>@tag.CreatedAt.ToString("yyyy-MM-dd HH:mm")</td> *@
                    <td>@tag.DisplayName</td>
                    <td>
                        <button type="button" class="btn btn-primary btn-sm"
                                onclick="toggleEdit('@tag.Id')">
                            Edit
                        </button>
                        <a asp-action="Delet" asp-route-id="@tag.Id"
                           asp-controller="AdminTags" 
                           class="btn btn-danger btn-sm"
                           onclick="return confirm('Are you sure you want to delete this tag?');">
                            Delete
                        </a>
                    </td>
                </tr>

                <!-- Hidden inline edit row -->
                <tr id="edit-row-@tag.Id" style="display:none;">
                    <td colspan="4">
                        <form asp-action="EditInline" asp-controller="AdminTags" method="post" class="d-flex gap-2">
                            <input type="hidden" name="id" value="@tag.Id" />
                            <input type="text" name="displayName" value="@tag.DisplayName" class="form-control" />
                            <button type="submit" class="btn btn-success btn-sm">Save</button>
                            <button type="button" class="btn btn-secondary btn-sm" onclick="toggleEdit('@tag.Id')">Cancel</button>
                        </form>
                    </td>
                </tr>
            }
        </tbody>

    </table>

@* @if (TempData["SuccessMessage"] != null && TempData["SuccessMessage"] == "Tag updated successfully!")
    {
         <div class="alert alert-success alert-dismissible fade show" role="alert">
            @TempData["SuccessMessage"]
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div> 
    }
    else if (TempData["SuccessMessage"] != null && TempData["SuccessMessage"] == "Deleted Unsuccessfully!")
    {
        <div class="alert alert-danger">
            @TempData["SuccessMessage"]
        </div>
} *@
    <script>
        function toggleEdit(id) {
            const row = document.getElementById("edit-row-" + id);
            row.style.display = row.style.display === "none" ? "table-row" : "none";
        }
              document.querySelectorAll("[data-time]").forEach(td => {
          const date = new Date(td.dataset.time);
          const diff = (new Date() - date) / 1000; // seconds
          let text;
          if (diff < 60) text = `${Math.floor(diff)} seconds ago`;
          else if (diff < 3600) text = `${Math.floor(diff/60)} minutes ago`;
          else if (diff < 86400) text = `${Math.floor(diff/3600)} hours ago`;
          else if (diff < 2592000) text = `${Math.floor(diff/86400)} days ago`;
          else if (diff < 31536000) text = `${Math.floor(diff/2592000)} months ago`;
          else text = `${Math.floor(diff/31536000)} years ago`;
          td.textContent = text;
        });
    </script>
